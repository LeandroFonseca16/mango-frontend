# üîå API Reference - MangoBeat AI Backend

## üìç Base Information

- **Base URL**: `http://localhost:3001/api/v1`
- **Production URL**: `https://api.mangobeat.com/api/v1`
- **API Version**: v1
- **Content-Type**: `application/json`
- **Authentication**: Bearer Token (JWT)

---

## üîê Authentication

### Register User

Create a new user account.

```http
POST /auth/register
Content-Type: application/json

{
  "email": "user@mangobeat.com",
  "password": "password123",
  "name": "User Name"
}
```

**Response (201 Created):**
```json
{
  "id": "clp1234567890abcdef",
  "email": "user@mangobeat.com",
  "name": "User Name",
  "avatar": null,
  "createdAt": "2024-11-07T12:00:00.000Z",
  "updatedAt": "2024-11-07T12:00:00.000Z"
}
```

**Errors:**
- `400 Bad Request`: Invalid input data
- `409 Conflict`: Email already exists

---

### Login

Authenticate user and get tokens.

```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@mangobeat.com",
  "password": "password123"
}
```

**Response (200 OK):**
```json
{
  "user": {
    "id": "clp1234567890abcdef",
    "email": "user@mangobeat.com",
    "name": "User Name",
    "avatar": null
  },
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Token Details:**
- **Access Token**: Expires in 15 minutes
- **Refresh Token**: Expires in 7 days

**Errors:**
- `400 Bad Request`: Invalid credentials
- `401 Unauthorized`: Wrong password

---

### Refresh Token

Get new access token using refresh token.

```http
POST /auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Response (200 OK):**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Errors:**
- `401 Unauthorized`: Invalid refresh token
- `403 Forbidden`: Refresh token expired

---

### Get Profile

Get current user profile (requires authentication).

```http
GET /auth/profile
Authorization: Bearer {accessToken}
```

**Response (200 OK):**
```json
{
  "id": "clp1234567890abcdef",
  "email": "user@mangobeat.com",
  "name": "User Name",
  "avatar": null,
  "createdAt": "2024-11-07T12:00:00.000Z",
  "updatedAt": "2024-11-07T12:00:00.000Z"
}
```

---

## üéµ Tracks Management

All track endpoints require authentication.

### Create Track

Create a new music track.

```http
POST /tracks
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "title": "Dark Phonk Beat",
  "description": "Heavy bass phonk track with dark vibes",
  "genre": "phonk",
  "tags": ["dark", "phonk", "bass", "electronic"],
  "audioPrompt": "Dark phonk beat with heavy 808 bass and aggressive synths",
  "imagePrompt": "Dark cyberpunk city at night with neon lights"
}
```

**Request Body:**
- `title` (string, required): Track title (2-100 characters)
- `description` (string, optional): Track description (max 500 characters)  
- `genre` (string, required): Music genre
- `tags` (string[], optional): Array of tags (max 10 tags)
- `audioPrompt` (string, required): Prompt for AI audio generation
- `imagePrompt` (string, optional): Prompt for AI image generation

**Response (201 Created):**
```json
{
  "id": "clp1234567891abcdef",
  "title": "Dark Phonk Beat",
  "description": "Heavy bass phonk track with dark vibes",
  "genre": "phonk",
  "tags": ["dark", "phonk", "bass", "electronic"],
  "audioUrl": null,
  "imageUrl": null,
  "duration": null,
  "status": "PROCESSING",
  "metadata": {
    "audioPrompt": "Dark phonk beat with heavy 808 bass and aggressive synths",
    "imagePrompt": "Dark cyberpunk city at night with neon lights"
  },
  "userId": "clp1234567890abcdef",
  "createdAt": "2024-11-07T12:05:00.000Z",
  "updatedAt": "2024-11-07T12:05:00.000Z"
}
```

**Track Status:**
- `PROCESSING`: Being generated by AI
- `COMPLETED`: Ready for use
- `FAILED`: Generation failed

---

### Get My Tracks

List tracks created by the authenticated user.

```http
GET /tracks/my?skip=0&take=10&status=COMPLETED&genre=phonk&search=dark
Authorization: Bearer {accessToken}
```

**Query Parameters:**
- `skip` (number, optional): Number of tracks to skip (default: 0)
- `take` (number, optional): Number of tracks to return (default: 10, max: 50)
- `status` (string, optional): Filter by status (PROCESSING, COMPLETED, FAILED)
- `genre` (string, optional): Filter by genre
- `search` (string, optional): Search in title and description

**Response (200 OK):**
```json
{
  "tracks": [
    {
      "id": "clp1234567891abcdef",
      "title": "Dark Phonk Beat",
      "description": "Heavy bass phonk track with dark vibes",
      "genre": "phonk",
      "tags": ["dark", "phonk", "bass", "electronic"],
      "audioUrl": "https://storage.mangobeat.com/audio/track1.mp3",
      "imageUrl": "https://storage.mangobeat.com/images/track1.jpg",
      "duration": 180,
      "status": "COMPLETED",
      "userId": "clp1234567890abcdef",
      "createdAt": "2024-11-07T12:05:00.000Z",
      "updatedAt": "2024-11-07T12:10:00.000Z"
    }
  ],
  "total": 25,
  "hasNext": true
}
```

---

### Get Track by ID

Get specific track details.

```http
GET /tracks/{trackId}
Authorization: Bearer {accessToken}
```

**Path Parameters:**
- `trackId` (string): Track UUID

**Response (200 OK):**
```json
{
  "id": "clp1234567891abcdef",
  "title": "Dark Phonk Beat",
  "description": "Heavy bass phonk track with dark vibes",
  "genre": "phonk",
  "tags": ["dark", "phonk", "bass", "electronic"],
  "audioUrl": "https://storage.mangobeat.com/audio/track1.mp3",
  "imageUrl": "https://storage.mangobeat.com/images/track1.jpg",
  "duration": 180,
  "status": "COMPLETED",
  "metadata": {
    "audioPrompt": "Dark phonk beat with heavy 808 bass and aggressive synths",
    "imagePrompt": "Dark cyberpunk city at night with neon lights",
    "processingTime": 45000,
    "aiModel": "musicgen-v1.2"
  },
  "userId": "clp1234567890abcdef",
  "createdAt": "2024-11-07T12:05:00.000Z",
  "updatedAt": "2024-11-07T12:10:00.000Z"
}
```

**Errors:**
- `404 Not Found`: Track not found
- `403 Forbidden`: Not authorized to access this track

---

### Update Track

Update track information.

```http
PUT /tracks/{trackId}
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "title": "Updated Dark Phonk Beat",
  "description": "Updated description",
  "tags": ["dark", "phonk", "updated"]
}
```

**Request Body** (all fields optional):
- `title` (string): New track title
- `description` (string): New description
- `tags` (string[]): New tags array

**Response (200 OK):**
```json
{
  "id": "clp1234567891abcdef",
  "title": "Updated Dark Phonk Beat",
  "description": "Updated description",
  "tags": ["dark", "phonk", "updated"],
  // ... other fields remain the same
  "updatedAt": "2024-11-07T13:00:00.000Z"
}
```

---

### Delete Track

Delete a track (only owner can delete).

```http
DELETE /tracks/{trackId}
Authorization: Bearer {accessToken}
```

**Response (204 No Content)**

**Errors:**
- `404 Not Found`: Track not found
- `403 Forbidden`: Not authorized to delete this track

---

## üìà Trends Analysis

### Get Popular Trends

Get currently popular TikTok trends.

```http
GET /trends/popular?limit=20&category=music
```

**Query Parameters:**
- `limit` (number, optional): Number of trends to return (default: 20, max: 50)
- `category` (string, optional): Filter by category (music, dance, comedy, etc.)

**Response (200 OK):**
```json
[
  {
    "id": "clp1234567892abcdef",
    "hashtag": "phonkmusic",
    "title": "Phonk Music Vibes",
    "description": "Dark electronic music with aggressive beats",
    "videoCount": 15420,
    "viewCount": "2500000",
    "category": "music",
    "isActive": true,
    "metadata": {
      "averageDuration": 30,
      "topCountries": ["US", "BR", "RU"],
      "growthRate": 0.15
    },
    "createdAt": "2024-11-07T08:00:00.000Z",
    "updatedAt": "2024-11-07T12:00:00.000Z"
  }
]
```

---

### Get Trending Now

Get currently trending hashtags.

```http
GET /trends/trending?limit=10&region=global
```

**Query Parameters:**
- `limit` (number, optional): Number of trends (default: 10, max: 25)
- `region` (string, optional): Region code (US, BR, global, etc.)

**Response (200 OK):**
```json
[
  {
    "id": "clp1234567893abcdef",
    "hashtag": "darkphonk",
    "title": "Dark Phonk Challenge",
    "description": "Users creating dark phonk beats and dance moves",
    "videoCount": 8920,
    "viewCount": "1200000",
    "category": "music",
    "isActive": true,
    "trendingScore": 95.5,
    "momentum": "rising",
    "createdAt": "2024-11-07T10:00:00.000Z",
    "updatedAt": "2024-11-07T12:00:00.000Z"
  }
]
```

---

### Get Trends by Category

Get trends filtered by category.

```http
GET /trends/category/{category}?limit=20
```

**Path Parameters:**
- `category` (string): Category name (music, dance, comedy, beauty, etc.)

**Available Categories:**
- `music`: Music-related trends
- `dance`: Dance challenges and choreography
- `comedy`: Comedy and humor content
- `beauty`: Beauty and makeup trends
- `fitness`: Workout and fitness content
- `food`: Cooking and food content
- `pets`: Pet-related content
- `diy`: Do-it-yourself and crafts
- `education`: Educational content
- `gaming`: Gaming content

**Response (200 OK):**
```json
[
  {
    "id": "clp1234567894abcdef",
    "hashtag": "musicproducer",
    "title": "Music Producer Tips",
    "description": "Tips and tricks for music production",
    "videoCount": 5430,
    "viewCount": "890000",
    "category": "music",
    "isActive": true,
    "subcategory": "production",
    "createdAt": "2024-11-07T09:00:00.000Z",
    "updatedAt": "2024-11-07T12:00:00.000Z"
  }
]
```

---

### Search Hashtag

Get detailed information about a specific hashtag.

```http
GET /trends/hashtag/{hashtag}
```

**Path Parameters:**
- `hashtag` (string): Hashtag name (without #)

**Response (200 OK):**
```json
{
  "id": "clp1234567892abcdef",
  "hashtag": "phonkmusic",
  "title": "Phonk Music Vibes",
  "description": "Dark electronic music with aggressive beats",
  "videoCount": 15420,
  "viewCount": "2500000",
  "category": "music",
  "isActive": true,
  "metadata": {
    "averageDuration": 30,
    "topCountries": ["US", "BR", "RU"],
    "growthRate": 0.15,
    "relatedHashtags": ["darkphonk", "phonkbeat", "bassboosted"],
    "peakHours": [18, 19, 20, 21],
    "ageGroups": {
      "13-17": 0.25,
      "18-24": 0.45,
      "25-34": 0.30
    }
  },
  "history": [
    {
      "date": "2024-11-06",
      "videoCount": 14200,
      "viewCount": "2300000"
    },
    {
      "date": "2024-11-07", 
      "videoCount": 15420,
      "viewCount": "2500000"
    }
  ],
  "createdAt": "2024-11-07T08:00:00.000Z",
  "updatedAt": "2024-11-07T12:00:00.000Z"
}
```

**Errors:**
- `404 Not Found`: Hashtag not found

---

### Start Trend Analysis (Authenticated)

Trigger a new trend analysis job.

```http
POST /trends/analyze?region=global&category=music
Authorization: Bearer {accessToken}
```

**Query Parameters:**
- `region` (string, optional): Region to analyze (default: global)
- `category` (string, optional): Category to focus on

**Response (202 Accepted):**
```json
{
  "jobId": "clp1234567895abcdef",
  "status": "PENDING",
  "estimatedTime": 300,
  "message": "Trend analysis started. Check job status for updates."
}
```

---

## üíº Jobs Management

All job endpoints require authentication.

### Get My Jobs

List jobs created by the authenticated user.

```http
GET /jobs/my?skip=0&take=10&status=PROCESSING&type=AUDIO_GENERATION
Authorization: Bearer {accessToken}
```

**Query Parameters:**
- `skip` (number, optional): Number of jobs to skip (default: 0)
- `take` (number, optional): Number of jobs to return (default: 10, max: 50)
- `status` (string, optional): Filter by status
- `type` (string, optional): Filter by job type

**Job Types:**
- `AUDIO_GENERATION`: AI music generation
- `IMAGE_GENERATION`: AI image generation  
- `TREND_ANALYSIS`: TikTok trend analysis
- `TIKTOK_UPLOAD`: Upload to TikTok

**Job Status:**
- `PENDING`: Waiting to be processed
- `PROCESSING`: Currently being processed
- `COMPLETED`: Successfully completed
- `FAILED`: Failed with error
- `CANCELLED`: Cancelled by user

**Response (200 OK):**
```json
{
  "jobs": [
    {
      "id": "clp1234567895abcdef",
      "type": "AUDIO_GENERATION",
      "status": "PROCESSING",
      "priority": 1,
      "data": {
        "prompt": "Dark phonk beat with heavy 808 bass",
        "duration": 180,
        "genre": "phonk"
      },
      "result": null,
      "error": null,
      "attempts": 1,
      "maxAttempts": 3,
      "progress": 45,
      "estimatedTime": 120,
      "trackId": "clp1234567891abcdef",
      "createdAt": "2024-11-07T12:05:00.000Z",
      "updatedAt": "2024-11-07T12:07:30.000Z",
      "processedAt": null
    }
  ],
  "total": 15,
  "hasNext": true
}
```

---

### Get Job Details

Get detailed information about a specific job.

```http
GET /jobs/{jobId}
Authorization: Bearer {accessToken}
```

**Response (200 OK):**
```json
{
  "id": "clp1234567895abcdef",
  "type": "AUDIO_GENERATION",
  "status": "COMPLETED",
  "priority": 1,
  "data": {
    "prompt": "Dark phonk beat with heavy 808 bass",
    "duration": 180,
    "genre": "phonk"
  },
  "result": {
    "audioUrl": "https://storage.mangobeat.com/audio/track1.mp3",
    "duration": 180,
    "format": "mp3",
    "quality": "high",
    "processingTime": 45000
  },
  "error": null,
  "attempts": 1,
  "maxAttempts": 3,
  "progress": 100,
  "logs": [
    {
      "timestamp": "2024-11-07T12:05:00.000Z",
      "level": "info",
      "message": "Job started"
    },
    {
      "timestamp": "2024-11-07T12:05:15.000Z",
      "level": "info", 
      "message": "AI model loaded"
    },
    {
      "timestamp": "2024-11-07T12:05:45.000Z",
      "level": "info",
      "message": "Audio generation completed"
    }
  ],
  "trackId": "clp1234567891abcdef",
  "createdAt": "2024-11-07T12:05:00.000Z",
  "updatedAt": "2024-11-07T12:05:45.000Z",
  "processedAt": "2024-11-07T12:05:45.000Z"
}
```

**Errors:**
- `404 Not Found`: Job not found
- `403 Forbidden`: Not authorized to access this job

---

### Retry Job

Retry a failed job.

```http
POST /jobs/{jobId}/retry
Authorization: Bearer {accessToken}
```

**Response (200 OK):**
```json
{
  "id": "clp1234567895abcdef",
  "status": "PENDING",
  "attempts": 2,
  "message": "Job queued for retry"
}
```

**Errors:**
- `400 Bad Request`: Job cannot be retried (not failed or max attempts reached)
- `404 Not Found`: Job not found
- `403 Forbidden`: Not authorized

---

### Cancel Job

Cancel a pending or processing job.

```http
DELETE /jobs/{jobId}
Authorization: Bearer {accessToken}
```

**Response (200 OK):**
```json
{
  "id": "clp1234567895abcdef",
  "status": "CANCELLED",
  "message": "Job cancelled successfully"
}
```

**Errors:**
- `400 Bad Request`: Job cannot be cancelled (already completed/failed)

---

### Get Job Statistics

Get statistics about user's jobs.

```http
GET /jobs/stats
Authorization: Bearer {accessToken}
```

**Response (200 OK):**
```json
{
  "total": 50,
  "byStatus": {
    "pending": 5,
    "processing": 2,
    "completed": 38,
    "failed": 4,
    "cancelled": 1
  },
  "byType": {
    "AUDIO_GENERATION": 25,
    "IMAGE_GENERATION": 15,
    "TREND_ANALYSIS": 8,
    "TIKTOK_UPLOAD": 2
  },
  "averageProcessingTime": {
    "AUDIO_GENERATION": 45000,
    "IMAGE_GENERATION": 15000,
    "TREND_ANALYSIS": 180000,
    "TIKTOK_UPLOAD": 5000
  },
  "successRate": 0.86,
  "last30Days": {
    "total": 25,
    "completed": 22,
    "failed": 3
  }
}
```

---

## üè• Health & Status

### Health Check

Check application health status.

```http
GET /health
```

**Response (200 OK):**
```json
{
  "status": "ok",
  "info": {
    "database": {
      "status": "up"
    },
    "redis": {
      "status": "up"
    },
    "memory_heap": {
      "status": "up"
    },
    "memory_rss": {
      "status": "up"
    }
  },
  "error": {},
  "details": {
    "database": {
      "status": "up"
    },
    "redis": {
      "status": "up"
    },
    "memory_heap": {
      "status": "up",
      "used": 67108864,
      "limit": 157286400
    },
    "memory_rss": {
      "status": "up", 
      "used": 134217728,
      "limit": 157286400
    }
  }
}
```

---

### API Information

Get API version and information.

```http
GET /info
```

**Response (200 OK):**
```json
{
  "name": "MangoBeat AI Backend",
  "version": "1.0.0",
  "description": "AI-powered music generation and TikTok trend analysis",
  "environment": "development",
  "nodeVersion": "18.17.0",
  "uptime": 3600,
  "timestamp": "2024-11-07T12:00:00.000Z",
  "features": {
    "audioGeneration": true,
    "imageGeneration": true,
    "trendAnalysis": true,
    "tiktokIntegration": false
  }
}
```

---

## üìù Common Response Patterns

### Success Response Structure

```typescript
interface SuccessResponse<T> {
  data: T;
  message?: string;
  timestamp: string;
}
```

### Error Response Structure

```typescript
interface ErrorResponse {
  error: {
    code: string;
    message: string;
    details?: any;
  };
  timestamp: string;
  path: string;
  method: string;
}
```

### Pagination Response

```typescript
interface PaginatedResponse<T> {
  items: T[];
  total: number;
  skip: number;
  take: number;
  hasNext: boolean;
  hasPrev: boolean;
}
```

---

## üö® Error Codes

### Authentication Errors

| Code | Status | Description |
|------|--------|-------------|
| `AUTH_001` | 401 | Invalid credentials |
| `AUTH_002` | 401 | Token expired |
| `AUTH_003` | 401 | Invalid token format |
| `AUTH_004` | 403 | Insufficient permissions |
| `AUTH_005` | 409 | Email already exists |

### Validation Errors

| Code | Status | Description |
|------|--------|-------------|
| `VAL_001` | 400 | Missing required field |
| `VAL_002` | 400 | Invalid email format |
| `VAL_003` | 400 | Password too weak |
| `VAL_004` | 400 | Invalid UUID format |
| `VAL_005` | 400 | Value out of range |

### Resource Errors

| Code | Status | Description |
|------|--------|-------------|
| `RES_001` | 404 | Resource not found |
| `RES_002` | 403 | Access denied |
| `RES_003` | 409 | Resource conflict |
| `RES_004` | 410 | Resource deleted |

### Processing Errors

| Code | Status | Description |
|------|--------|-------------|
| `PROC_001` | 500 | AI generation failed |
| `PROC_002` | 503 | Service temporarily unavailable |
| `PROC_003` | 429 | Rate limit exceeded |
| `PROC_004` | 507 | Storage quota exceeded |

---

## üîß Rate Limiting

### Global Limits

- **Authenticated requests**: 1000 per hour
- **Unauthenticated requests**: 100 per hour
- **Track creation**: 20 per hour
- **Job creation**: 50 per hour

### Rate Limit Headers

```http
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1699372800
```

---

## üìö SDKs and Examples

### JavaScript/TypeScript SDK

```typescript
import { MangoBeatClient } from '@mangobeat/sdk';

const client = new MangoBeatClient({
  baseURL: 'https://api.mangobeat.com/api/v1',
  apiKey: 'your-api-key'
});

// Create track
const track = await client.tracks.create({
  title: 'My Dark Phonk Beat',
  genre: 'phonk',
  audioPrompt: 'Dark phonk with heavy bass'
});

// Monitor job
const job = await client.jobs.get(track.jobId);
```

### Python SDK

```python
from mangobeat import MangoBeatClient

client = MangoBeatClient(
    base_url="https://api.mangobeat.com/api/v1",
    api_key="your-api-key"
)

# Create track
track = client.tracks.create({
    "title": "My Dark Phonk Beat",
    "genre": "phonk", 
    "audioPrompt": "Dark phonk with heavy bass"
})

# Get trends
trends = client.trends.get_popular(limit=10)
```

---

## üéØ Postman Collection

Import this collection URL into Postman:

```
https://api.mangobeat.com/docs/postman-collection.json
```

Or use these curl examples:

```bash
# Register
curl -X POST http://localhost:3001/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email": "test@mangobeat.com", "password": "password123", "name": "Test User"}'

# Login
curl -X POST http://localhost:3001/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@mangobeat.com", "password": "password123"}'

# Create Track (replace TOKEN)
curl -X POST http://localhost:3001/api/v1/tracks \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TOKEN" \
  -d '{"title": "Dark Phonk", "genre": "phonk", "audioPrompt": "Dark phonk beat"}'

# Get Trends
curl -X GET http://localhost:3001/api/v1/trends/popular?limit=10
```

---

**For more information, visit our [developer portal](https://dev.mangobeat.com) ü•≠**